<!DOCTYPE html>
<html>
  <head>
    
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="shortcut icon" href="/static/img/favicon.ico" />
        <title>Installing Arch: Setting up the system - Mauricio Cáceres Bravo</title>
        <meta name="author" content="Mauricio Cáceres Bravo" />
        <meta name="description" content="Installing Arch: Setting up the system" />
        <meta name="keywords" content="Installing Arch: Setting up the system, Mauricio Cáceres Bravo, linux, arch, install" />

        <meta content="0" property="fb:app_id">
        <meta content="Mauricio Cáceres Bravo" property="og:site_name">
        
          <meta content="Installing Arch: Setting up the system" property="og:title">
        
        
          <meta content="article" property="og:type">
        
        
          <meta content="My personal website" property="og:description">
        
        
          <meta content="http://localhost:4000/linux/arch/install/2017/02/10/install-arch-partI.html" property="og:url">
        
        
          <meta content="2017-02-10T08:28:24-05:00" property="article:published_time">
          <meta content="http://localhost:4000/about/" property="article:author">
        
        
          <meta content="http://localhost:4000/static/img/logo-high-resolution.png" property="og:image">
        
        
          
          <meta content="linux" property="article:section">
          
        
        
          
        
        <meta name="twitter:card" content="summary">
        <meta name="twitter:site" content="@\#">
        <meta name="twitter:creator" content="@\#">
        
          <meta name="twitter:title" content="Installing Arch: Setting up the system">
        
        
          <meta name="twitter:url" content="http://localhost:4000/linux/arch/install/2017/02/10/install-arch-partI.html">
        
        
          <meta name="twitter:description" content="My personal website">
        
        

      <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml">
      <script type="text/javascript">window.baseurl = 'http://localhost:4000';</script>
      
        <!-- Custom Fonts -->
        <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Roboto:300,400,500,700" type="text/css">

        <!-- FontAwesome icons -->
        <link rel="stylesheet" href="https://use.fontawesome.com/74dfc6cf47.css">

        <link rel="stylesheet" href="/static/css/styles.css">
        <!-- Core BootStrap CSS -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
        <!-- Material Design CSS -->
        <link rel="stylesheet" href="/static/css/bootstrap-material-design.min.css">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/static/css/syntax.css">

        <!-- Custom CSS -->        
        <link rel="stylesheet" href="/static/css/thickbox.css">
        <link rel="stylesheet" href="/static/css/main.css">
        <link rel="stylesheet" href="/static/css/projects.css">
        <link rel="stylesheet" href="/static/css/resume.css">

        <script type="text/javascript">
          //loadingImage is relative to project dir
          var tb_pathToImage = "/static/img/loadingAnimation.gif";
        </script>

  </head>

  <body class="home overflow-hidden">
    <div class="header-panel shadow-z-2">
      <div class="container">
        <div class="row">
          <div class="col-md-6 col-sm-8 col-xs-24">
            <div class="row-picture"></div>
            <div class="row-details">
              <h1 class="list-group-item-heading">Mauricio Cáceres Bravo</h1>
              <p class="list-group-item-text" style="font-size:18px;">Research Assistant at Yale SOM</p>
              <!-- <div class="social-icons">
	
        <a class="icon" target="_blank" href=""><i class="fa fa-facebook"></i></a>
    
        <a class="icon" target="_blank" href=""><i class="fa fa-twitter"></i></a>
    
        <a class="icon" target="_blank" href=""><i class="fa fa-linkedin"></i></a>
    
        <a class="icon" target="_blank" href=""><i class="fa fa-stack-exchange"></i></a>
    
</div>
 -->
            </div>
            <div class="navbar-header pull-right">
              <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                <span class="sr-only">Toggle navigation</span>
                <i class="fa fa-2x fa-bars"></i>
              </button>
            </div>
          </div>
          <!-- <div class="col&#45;md&#45;9 col&#45;sm&#45;8 col&#45;xs&#45;12"> -->
          <!-- <div class="row"> -->
          <!--   <h2 class="blog&#45;title&#45;pro col&#45;md&#45;6 col&#45;sm&#45;12 col&#45;xs&#45;12 ">Installing Arch: Setting up the system</h2> -->
          <!--    -->
          <!--   <div class="col&#45;md&#45;6 col&#45;sm&#45;12 col&#45;xs&#45;12 searchcontrol" id="js&#45;search"> -->
          <!--     <input class="form&#45;control" type="text" id="js&#45;search__input" placeholder="Search"> -->
          <!--     <ul class="search__results" id="js&#45;search__results"></ul> -->
          <!--   </div> -->
          <!--    -->
          <!--   </div> -->
          <!--   <p class="info"> -->
          <!--      -->
          <!--       <span class="time">10 Feb 2017</span> -->
          <!--      -->
          <!--      -->
          <!--       <span class="categories"> -->
          <!--         &#38;raquo;  -->
          <!--          -->
          <!--           <a href="/category/linux">linux</a> -->
          <!--           ,  -->
          <!--          -->
          <!--           <a href="/category/arch">arch</a> -->
          <!--           ,  -->
          <!--          -->
          <!--           <a href="/category/install">install</a> -->
          <!--            -->
          <!--          -->
          <!--       </span> -->
          <!--      -->
          <!--   </p> -->
          <!-- </div> -->
        </div>
      </div>
    </div>

    <div class="container main outer">
      <div class="row">
        <div class="col-md-3 col-xs-12">
              <nav class="menu">
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
    <ul class="list-separator nav navbar-nav well well-primary post" style="margin-right:6px;padding-right:6px;">

	
	
	
	
	
	
    
	
	<!-- <li class="col&#45;lg&#45;12 col&#45;md&#45;12 col&#45;sm&#45;4 col&#45;xs&#45;12 current-menu-item install-arch-partI.html"><a href="/" target="_self"><i class="fa fa-home"></i> Home</a></li> -->
	<li class="col-lg-12 col-md-12 col-sm-4 col-xs-12 current-menu-item install-arch-partI.html"
        style="margin-left:0px;padding-left:0px;">
        <a href="/" target="_self">
            <i class="fa fa-home" style="width:42px;"></i>
            Home
        </a>
    </li>

	
	
	
	
	
	
    
	
	<!-- <li class="col&#45;lg&#45;12 col&#45;md&#45;12 col&#45;sm&#45;4 col&#45;xs&#45;12  install-arch-partI.html"><a href="/coding" target="_self"><i class="fa fa-code"></i> Coding</a></li> -->
	<li class="col-lg-12 col-md-12 col-sm-4 col-xs-12  install-arch-partI.html"
        style="margin-left:0px;padding-left:0px;">
        <a href="/coding" target="_self">
            <i class="fa fa-code" style="width:42px;"></i>
            Coding
        </a>
    </li>

	
	
	
	
	
	
    
	
	<!-- <li class="col&#45;lg&#45;12 col&#45;md&#45;12 col&#45;sm&#45;4 col&#45;xs&#45;12  install-arch-partI.html"><a href="/resume/" target="_self"><i class="fa fa-graduation-cap"></i> Resume</a></li> -->
	<li class="col-lg-12 col-md-12 col-sm-4 col-xs-12  install-arch-partI.html"
        style="margin-left:0px;padding-left:0px;">
        <a href="/resume/" target="_self">
            <i class="fa fa-graduation-cap" style="width:42px;"></i>
            Resume
        </a>
    </li>

	
	
	
	
	
	
    
	
	<!-- <li class="col&#45;lg&#45;12 col&#45;md&#45;12 col&#45;sm&#45;4 col&#45;xs&#45;12  install-arch-partI.html"><a href="/research" target="_self"><i class="fa fa-university"></i> Research</a></li> -->
	<li class="col-lg-12 col-md-12 col-sm-4 col-xs-12  install-arch-partI.html"
        style="margin-left:0px;padding-left:0px;">
        <a href="/research" target="_self">
            <i class="fa fa-university" style="width:42px;"></i>
            Research
        </a>
    </li>

	
	
	
	
	
	
    
	
	<!-- <li class="col&#45;lg&#45;12 col&#45;md&#45;12 col&#45;sm&#45;4 col&#45;xs&#45;12  install-arch-partI.html"><a href="/blog/" target="_self"><i class="fa fa-comments"></i> Blog</a></li> -->
	<li class="col-lg-12 col-md-12 col-sm-4 col-xs-12  install-arch-partI.html"
        style="margin-left:0px;padding-left:0px;">
        <a href="/blog/" target="_self">
            <i class="fa fa-comments" style="width:42px;"></i>
            Blog
        </a>
    </li>

	
	
	
	
	
	
    
	
	<!-- <li class="col&#45;lg&#45;12 col&#45;md&#45;12 col&#45;sm&#45;4 col&#45;xs&#45;12  install-arch-partI.html"><a href="/about/" target="_self"><i class="fa fa-user"></i> About</a></li> -->
	<li class="col-lg-12 col-md-12 col-sm-4 col-xs-12  install-arch-partI.html"
        style="margin-left:0px;padding-left:0px;">
        <a href="/about/" target="_self">
            <i class="fa fa-user" style="width:42px;"></i>
            About
        </a>
    </li>

	
	
	
	
	
	
    
	
	<!-- <li class="col&#45;lg&#45;12 col&#45;md&#45;12 col&#45;sm&#45;4 col&#45;xs&#45;12  install-arch-partI.html"><a href="https://github.com/mcaceresb" target="_self"><i class="fa fa-github"></i> Github</a></li> -->
	<li class="col-lg-12 col-md-12 col-sm-4 col-xs-12  install-arch-partI.html"
        style="margin-left:0px;padding-left:0px;">
        <a href="https://github.com/mcaceresb" target="_self">
            <i class="fa fa-github" style="width:42px;"></i>
            Github
        </a>
    </li>

</ul>

    </div>
    </nav>

        </div>
        <div class="col-md-9 col-xs-12 full">
          <div class="list-group">
    <h4 class="home-subtitle" style="font-size:39px">
      Installing Arch: Setting up the system
    </h4>
    <div class="fullw-list-group-separator"></div>
</div>

<!-- <div class="post&#45;content well"> -->
<div class="post-content">
<article class="content">
    <div class="post"><p>I am a fan of <a href="https://en.wikipedia.org/wiki/GNU/Linux">GNU/Linux</a> (or
just “Linux” if you hate Richard Stallman). My first Linux distro was
<a href="https://www.ubuntu.com/">Ubuntu</a> but, alas, it was not meant to be.
Though Ubuntu is truly awesome for putting ease of use front and center,
over time my idea of “ease of use” started to drift from Ubuntu’s idea
of ease of use.</p>

<p>These days I have gravitated towards Arch. The
<a href="https://wiki.archlinux.org">Arch wiki</a> is awesome
and a half, and they have a full <a href="https://wiki.archlinux.org/index.php/Beginners%27_guide">installation
guide</a>
available. However, there is a specific setup I like most and this is
meant to summarize that setup into an easy-to-follow step-by-step guide.</p>

<p>Commands between <code class="highlighter-rouge">[encryption-lvm]</code> tags need only be run if you want
to set up encryption with LVM and they are run in lieu of commands
in <code class="highlighter-rouge">[standatd]</code> tags (LVM is recommended; easiest guide I found is
<a href="http://www.brandonkester.com/tech/2013/03/16/full-disk-encryption
-in-arch-linux-with-uefi.html">here</a>).</p>

<h2 id="step-1-partition-and-format-the-drive">Step 1: Partition and format the drive</h2>

<p>Some basic sanity checks</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>ls /sys/firmware/efi/efivars <span class="c"># Should be populated</span>
wifi-menu                    <span class="c"># Will connect automatically</span>
timedatectl <span class="nb">set</span>-ntp <span class="nb">true
</span>timedatectl status
</code></pre>
</div>

<p>Now partition the disk (EFI)</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="c"># I use parted; alternatively use gdisk or cdisk</span>
parted /dev/sda
mklabel gpt
mkpart ESP fat32 1MiB 513MiB
<span class="nb">set </span>1 boot on

<span class="c"># [encryption-lvm]</span>
mkpart primary ext4 513MiB 100%
<span class="c"># [encryption-lvm]</span>

<span class="c"># [standard]</span>
mkpart primary linux-swap 513MiB 8.5GiB
mkpart primary ext4 8.5GiB 100%
<span class="c"># [standard]</span>

quit
mkfs.vfat /dev/sda1
</code></pre>
</div>

<p>Format drive and mount</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="c"># [encryption-lvm]</span>
cryptsetup luksFormat /dev/sda2
cryptsetup open --type luks /dev/sda2 lvm
pvcreate /dev/mapper/lvm
vgcreate vol0 /dev/mapper/lvm
lvcreate --name lvswap -L 6GB vol0
lvcreate --name lvroot -l 100%FREE vol0
mkswap /dev/mapper/vol0-lvswap
swapon /dev/mapper/vol0-lvswap
mkfs.ext4 /dev/mapper/vol0-lvroot
mount /dev/mapper/vol0-lvroot /mnt
<span class="c"># [encryption-lvm]</span>

<span class="c"># [standard]</span>
mkfs.ext4 /dev/sda3
mkswap /dev/sda2
swapon /dev/sda2
mount /dev/sda3 /mnt
<span class="c"># [standard]</span>

mkdir /mnt/boot
mount /dev/sda1 /mnt/boot
pacstrap -i /mnt base base-devel
<span class="c"># If you get a PGP key error, do</span>
<span class="c"># dirmngr &lt;/dev/null</span>
<span class="c"># pacman-key --populate archlinux</span>
<span class="c"># pacman-key --refresh-keys</span>
<span class="c"># Then retun pacstrap</span>
genfstab -U /mnt &gt; /mnt/etc/fstab
cp /etc/netctl/yournetworkname /mnt/etc/netctl/yournetworkname
</code></pre>
</div>

<p><strong>NOTE:</strong> If you want to mount extra partitions, make sure you mounted them here. For instance, <code class="highlighter-rouge">mkdir  /mnt/mnt/large &amp;&amp; mount /dev/sdY1 /mnt/mnt/large</code> or something, <em>BEFORE</em> <code class="highlighter-rouge">genfstab</code>.</p>

<h2 id="step-2-chroot-and-install-base-system">Step 2: Chroot and install base system</h2>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>arch-chroot /mnt /bin/bash

locale-gen
localectl <span class="nb">set</span>-locale <span class="nv">LANG</span><span class="o">=</span>en_US.UTF-8
vi /etc/locale.gen <span class="c"># Uncomment en_US.UTF-8</span>
<span class="nb">echo </span><span class="nv">LANG</span><span class="o">=</span>en_US.UTF-8 &gt; /etc/locale.conf
<span class="nb">export</span> <span class="sb">`</span>cat /etc/locale.conf<span class="sb">`</span>
locale-gen

tzselect
ln -s /usr/share/zoneinfo/America/New_York /etc/localtime
hwclock --systohc --utc

<span class="nb">echo </span>vm.swappiness<span class="o">=</span>10 &gt; /etc/sysctl.d/99-sysctl.conf
vi /etc/pacman.conf <span class="c"># Uncomment multilib</span>

<span class="nb">echo </span>hostname &gt; /etc/hostname
vi /etc/hosts
<span class="c"># Copy the 127.0.0.1 and replace localhost with hostname</span>

pacman -Sy
pacman -S iw wpa_supplicant dialog intel-ucode
</code></pre>
</div>

<h2 id="step-3-configure-the-boot-loader">Step 3: Configure the boot loader</h2>

<p><em><strong>Pro-tip:</strong></em> I have occasionally messed up my bootloader; when that happens I fire up a live arch USB, mount my partitions (using lvm if applicable), chroot into the system, and fix the bootloader here.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>bootctl install
cp /usr/share/systemd/bootctl/arch.conf /boot/loader/entries/
<span class="nb">echo</span> <span class="sb">`</span>blkid /dev/sdb2<span class="sb">`</span> &gt;&gt; /boot/loader/entries/arch.conf
<span class="c"># File should look like this</span>
<span class="c">#   title   Arch Lnux</span>
<span class="c">#   linux   /vmlinuz-linux</span>
<span class="c">#   initrd  /initramfs-linux.img</span>
<span class="c"># [encryption-lvm]</span>
<span class="c">#   options cryptdevice=UUID=&lt;INSERT-UUID-HERE&gt;:lvm:allow-discards resume=/dev/mapper/vol0-lvswap root=/dev/mapper/vol0-lvroot rw quiet</span>
<span class="c"># [encryption-lvm]</span>
<span class="c"># [standard]</span>
<span class="c">#   options root=PARTUUID=&lt;INSERT-PARTUUID-HERE&gt; rootfstype=ext4 rw</span>
<span class="c"># [standard]</span>

bootctl update
<span class="c"># [encryption-lvm]</span>
<span class="c"># vi /etc/mkinitcpio.conf</span>
<span class="c">#   Add "keymap encrypt lvm2 resume" to HOOKS="..."</span>
<span class="c">#   HOOKS="base udev autodetect modconf block keymap encrypt lvm2 resume filesystems keyboard fsck"</span>
<span class="c"># [encryption-lvm]</span>

mkinitcpio -p linux
passwd
<span class="nb">exit
</span>umount -R /mnt/boot
umount -R /mnt
reboot
</code></pre>
</div>

<h2 id="step-4-set-up-your-own-user-account">Step 4: Set up your own user account</h2>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>useradd -m -s /bin/bash user
passwd user
visudo <span class="c"># Add to end of file: user ALL=(ALL) ALL</span>
pacman -S sudo bash-completion git rfkill
<span class="nb">exit</span>
</code></pre>
</div>

<p>Log in and install install pacaur. You can use <code class="highlighter-rouge">pacaur</code> (though I think using <code class="highlighter-rouge">yaourt</code> is more standard) to query the <a href="aur.archlinux.org">Arch User Repositories (AUR)</a>.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>mkdir ~/Documents
mkdir ~/Downloads
mkdir ~/Pictures
mkdir ~/Music
mkdir ~/Videos

<span class="nb">cd</span> ~/Downloads
git clone https://aur.archlinux.org/package-query
git clone https://aur.archlinux.org/yaourt
<span class="nb">cd </span>package-query
makepkg -si
<span class="nb">cd</span> ../yaourt
makepkg -si

<span class="c"># yaourt is supposedly standard but can be very annoying.</span>
<span class="c"># I've been trying out pacaur</span>
gpg --recv-keys 1EB2638FF56C0C53
yaourt -S pacaur
</code></pre>
</div>

<p>You can now follow my preferred setup or go to <a href="http://https://wiki.archlinux.org/index.php/General_recommendations">the recommendations page</a></p>
</div>
    <hr />
    <div class="share-page">
    Share this on &rarr;
 <a href="https://twitter.com/share" class="twitter-share-button" data-via="\#">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

<!-- Google + -->
<div class="g-plus" data-action="share" data-annotation="bubble"></div>
<script src="https://apis.google.com/js/platform.js" async defer></script>

<!-- Facebook -->
<div class="fb-share-button" data-href="http://localhost:4000/linux/arch/install/2017/02/10/install-arch-partI.html" data-layout="button_count" style="position: relative; top: -8px; left: 3px;"></div>
</div>
<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.6&appId=0";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
</article>

<hr />


    
    
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
    

    
    
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
    



<div class="PageNavigation">
  
  
    <a class="next pull-right" href="http://localhost:4000/stata/plugins/2017/02/14/writing-stata-plugins-example.html">Writing my first Stata plugin: A real world use case &raquo;</a>
  
</div>

<!-- <div class="disqus&#45;comments"> -->
<!--     <div id="disqus_thread"></div> -->
<!--     <script type="text/javascript"> -->
<!--         /* <![CDATA[ */ -->
<!--  -->
<!--         var disqus_shortname = ""; -->
<!--         var disqus_identifier = "http://localhost:4000_Installing Arch: Setting up the system"; -->
<!--         var disqus_title = "Installing Arch: Setting up the system"; -->
<!--  -->
<!--         /* * * DON'T EDIT BELOW THIS LINE * * */ -->
<!--         (function() { -->
<!--             var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true; -->
<!--             dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js'; -->
<!--             (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq); -->
<!--         })(); -->
<!--     /* ]]> */ -->
<!--     </script> -->
<!-- </div> -->
</div>

          <div class="row">
            <div class="col-md-12 col-xs-12 footer">
              <footer>
  © 2018 Mauricio Cáceres Bravo - Powered by Jekyll.
</footer>

<div align="center">
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <ins class="adsbygoogle"
    style="display:block"
    data-ad-client="ca-pub-0000000000000000"
    data-ad-slot="0000000000"
    data-ad-format="auto"></ins>
  <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
</div>

            </div>
          </div>
        </div> <!-- end /.col-md-9 -->
      </div> <!-- end /.row -->
    </div>

    
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script src="https://code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

<script src="/static/js/super-search.js"></script>

<script src="/static/js/thickbox-compressed.js"></script>
<script src="/static/js/material.min.js"></script>
<script src="/static/js/main.js"></script>
<script src="/static/js/projects.js"></script>
<script async defer src="/static/js/github_api.min.js"></script>

    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-91854317-1', 'auto');
  ga('send', 'pageview');

</script>
  </body>
</html>
